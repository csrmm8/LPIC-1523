GuÃ­a: Crear y Usar una LibrerÃ­a Compartida en Ubuntu 24.04
ğŸ¯ Objetivo
Crear una librerÃ­a compartida .so en C, compilar un programa que la use y verificar su carga en tiempo de ejecuciÃ³n.

ğŸ“ Estructura del Proyecto



mi-libreria/
â”œâ”€â”€ build
â”‚   â”œâ”€â”€ include
â”‚   â””â”€â”€ lib
â”œâ”€â”€ include
â”‚   â””â”€â”€ mi_lib.h
â”œâ”€â”€ lib
â”‚   â””â”€â”€ mi_funcion.c
â””â”€â”€ src
    â””â”€â”€ main.c
âœ… Paso 1: Instalar herramientas necesarias
Ejecuta:

sudo apt update
sudo apt install build-essential

âœ… Paso 2: Crear los archivos
Archivo de cabecera: include/mi_lib.h
Crea el archivo con este contenido:

#ifndef MI_LIB_H
#define MI_LIB_H

void saluda();

#endif

CÃ³digo de la librerÃ­a: lib/mi_funcion.c
#include <stdio.h>
#include "mi_lib.h"

void saluda() {
printf("Â¡Hola desde la librerÃ­a!\n");
}

Programa principal: src/main.c
#include "mi_lib.h"

int main() {
saluda();
return 0;
}

âœ… Paso 3: Compilar el archivo objeto de la librerÃ­a
gcc -fPIC -Iinclude -c lib/mi_funcion.c -o build/lib/mi_funcion.o

âœ… Paso 4: Crear la librerÃ­a compartida .so
gcc -shared -o build/lib/libmi_lib.so build/lib/mi_funcion.o

âœ… Paso 5: Compilar el programa principal
gcc -Iinclude -Lbuild/lib src/main.c -lmi_lib -o build/main

âœ… Paso 6: Ejecutar el programa
export LD_LIBRARY_PATH=build/lib:$LD_LIBRARY_PATH
./build/main

DeberÃ­as ver:

Â¡Hola desde la librerÃ­a!

âœ… Paso 7: Verificar si la librerÃ­a se carga correctamente
ldd ./build/main

Busca una lÃ­nea similar a:

libmi_lib.so => ./build/lib/libmi_lib.so (0x00007ffff7dd4000)

âœ… Paso 8: (Opcional) Limpiar y reconstruir
Para limpiar:

rm build/lib/.o build/lib/ .so build/main

Y repite los pasos desde el 3.

ğŸ§° Resumen Final de Comandos
Compilar objeto
gcc -fPIC -Iinclude -c lib/mi_funcion.c -o build/lib/mi_funcion.o
Crear librerÃ­a .so
gcc -shared -o build/lib/libmi_lib.so build/lib/mi_funcion.o
Compilar programa
gcc -Iinclude -Lbuild/lib src/main.c -lmi_lib -o build/main
Ejecutar
export LD_LIBRARY_PATH=build/lib:$LD_LIBRARY_PATH && ./build/main
Ver dependencias
ldd ./build/main
